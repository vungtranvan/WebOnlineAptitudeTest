@model WebOnlineAptitudeTest.Areas.Admin.Data.Model.ToTalRecordTables
@{
    ViewBag.Title = "Home";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

@section Breadcrumb{
    <div class="page-breadcrumb">
        <div class="row">
            <div class="col-7 align-self-center">
                <h3 class="page-title text-truncate text-dark font-weight-medium mb-1">Home</h3>
                <div class="d-flex align-items-center">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb m-0 p-0">
                            <li class="breadcrumb-item"><a href="/admin" class="text-muted">Home</a></li>
                            <li class="breadcrumb-item text-muted active" aria-current="page">Dashboard</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
}
<!-- *************************************************************** -->
<!-- Start First Cards -->
<!-- *************************************************************** -->
<div class="card-group">
    <div class="card border-right">
        <a href="@Url.Action("Index","Account")">
            <div class="card-body">
                <div class="d-flex d-lg-flex d-md-block align-items-center">
                    <div>
                        <div class="d-inline-flex align-items-center">
                            <h2 class="text-dark mb-1 font-weight-medium">@Model.TotalAdmin</h2>
                        </div>
                        <h6 class="text-muted font-weight-normal mb-0 w-100 text-truncate">Account Manager Admin</h6>
                    </div>
                    <div class="ml-auto mt-md-3 mt-lg-0">
                        <span class="opacity-7 text-muted"><i data-feather="user-plus"></i></span>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="card border-right">
        <a href="@Url.Action("Index","Candidate")">
            <div class="card-body">
                <div class="d-flex d-lg-flex d-md-block align-items-center">
                    <div>
                        <h2 class="text-dark mb-1 w-100 text-truncate font-weight-medium">
                            <sup class="set-doller"></sup>@Model.TotalCandidate
                        </h2>
                        <h6 class="text-muted font-weight-normal mb-0 w-100 text-truncate">
                            Candidate
                        </h6>
                    </div>
                    <div class="ml-auto mt-md-3 mt-lg-0">
                        <span class="opacity-7 text-muted"><i class="fas fa-rocket"></i></span>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="card border-right">
        <a href="@Url.Action("Index","Question")">
            <div class="card-body">
                <div class="d-flex d-lg-flex d-md-block align-items-center">
                    <div>
                        <div class="d-inline-flex align-items-center">
                            <h2 class="text-dark mb-1 font-weight-medium">@Model.TotalQuestion</h2>
                        </div>
                        <h6 class="text-muted font-weight-normal mb-0 w-100 text-truncate">Question</h6>
                    </div>
                    <div class="ml-auto mt-md-3 mt-lg-0">
                        <span class="opacity-7 text-muted"><i class="fas fa-box-open"></i></span>
                    </div>
                </div>
            </div>
        </a>
    </div>
    <div class="card">
        <a href="@Url.Action("Index","TestSchedule")">
            <div class="card-body">
                <div class="d-flex d-lg-flex d-md-block align-items-center">
                    <div>
                        <h2 class="text-dark mb-1 font-weight-medium">@Model.TotalTestSchedule</h2>
                        <h6 class="text-muted font-weight-normal mb-0 w-100 text-truncate">TestSchedule</h6>
                    </div>
                    <div class="ml-auto mt-md-3 mt-lg-0">
                        <span class="opacity-7 text-muted"><i data-feather="globe"></i></span>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>


<div class="row">
    <div class="col-lg-8 col-md-12 ">
        <div class="card" style="height:100%">
            <div class="card-body">
                <canvas id="polar-chartCandi" class="chartjs-render-monitor"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-12">
        <div class="card">
            <div class="card-body">
                <div>
                    <canvas id="morris-area-chartCandiJoin" height="150"></canvas>
                </div>

            </div>
        </div>
        <div class="card" style="margin-bottom:0">
            <div class="card-body">
                <div>
                    <canvas id="morris-area-chartCandi" height="150"></canvas>
                </div>

            </div>
        </div>
    </div>

</div>
<div class="row" style="margin-top: 30px">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center mb-4">
                    <h4 class="card-title">
                        Latest passers
                    </h4>
                </div>

                <div class="table-responsive">
                    <table class="table no-wrap v-middle mb-0">
                        <thead>
                            <tr class="border-0">
                                <th class="border-0 font-14 font-weight-medium text-muted  px-2">
                                    Name
                                </th>
                                <th class="border-0 font-14 font-weight-medium text-muted px-2">
                                    Result
                                </th>
                                <th class="border-0 font-14 font-weight-medium text-muted  px-2"> Date of participation</th>
                                <th class="border-0 font-14 font-weight-medium text-muted  px-2"> Date of transfer</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (ViewBag.Recents != null)
                            {
                                foreach (WebOnlineAptitudeTest.Models.ViewModels.RecentsCandinade c in ViewBag.Recents)
                                {
                                    <tr>
                                        <td class="border-top-0 px-2 py-4">
                                            <div class="d-flex no-block align-items-center">
                                                <div class="mr-3"><img src="@c.Image" alt="user" class="rounded-circle" width="45" height="45"></div>
                                                <div class="">
                                                    <h5 class="text-dark mb-0 font-16 font-weight-medium">
                                                        @c.Name
                                                    </h5>
                                                    <span class="text-muted font-14">@c.Email</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="border-top-0 px-2 py-4">
                                            <div class="popover-icon d-flex latest-passers">
                                                <a class="btn btn-primary rounded-circle btn-circle font-12 popover-item d-flex" href="javascript:void(0)">@c.GeneralKnowledge.Value</a>
                                                <a class="btn btn-danger rounded-circle btn-circle font-12 popover-item d-flex" href="javascript:void(0)">@c.Mathematics.Value</a>
                                                <a class="btn btn-cyan rounded-circle btn-circle font-12 popover-item d-flex" href="javascript:void(0)">@c.ComputerTechnology</a>
                                                <a class="btn btn-success text-white rounded-circle btn-circle font-14 d-flex" href="javascript:void(0)">@c.AverageMark</a>
                                            </div>
                                        </td>

                                        <td class="border-top-0 font-weight-medium text-muted px-2 py-4">
                                            @c.ParticipateDate
                                        </td>

                                        <td class="border-top-0 font-weight-medium text-muted px-2 py-4">
                                            @c.TranferDate
                                        </td>
                                    </tr>
                                }
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
@section Scripts{
    <script>
        $(document).ready(function () {

            $.ajax({
                url: '/Homes/LoadStatusCandi',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    let labelChart = [];
                    let backgroundColorChart = [];
                    let dataChart = [];

                    $.each(response.data, function (i, item) {

                        if (item.Status == 0) {
                            labelChart.push('New');
                            backgroundColorChart.push('rgb(54, 162, 235)');
                        } else if (item.Status == 1) {
                            labelChart.push('Undone');
                            backgroundColorChart.push('#AAA');
                        } else if (item.Status == 2) {
                            labelChart.push('Scheduled');
                            backgroundColorChart.push('rgb(255, 205, 86)');
                        } else if (item.Status == 3) {
                            labelChart.push('InProgress');
                            backgroundColorChart.push('rgb(201, 203, 207)');
                        } else if (item.Status == 4) {
                            labelChart.push('Done');
                            backgroundColorChart.push('rgb(75, 192, 192)');
                        } else if (item.Status == 5) {
                            labelChart.push('Quit');
                            backgroundColorChart.push('rgb(255, 99, 132)');
                        }

                        dataChart.push(item.CountTotal);
                    });


                    new Chart(document.getElementById("polar-chartCandi"), {
                        //type: 'polarArea',
                        type: 'pie',
                        data: {
                            labels: labelChart,
                            datasets: [
                                {
                                    label: "Online Aptitude Test",
                                    backgroundColor: backgroundColorChart,
                                    data: dataChart
                                }
                            ]
                        },
                        options: {
                            title: {
                                display: true,
                                text: 'Online Aptitude Test For Status Candidate'
                            }
                        }
                    });
                }
            });


            $.ajax({
                url: '/Homes/LoadCandiLast5Mounth',
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                  
                    var lastCandi = 0;
                    lastCandi += response.dataAll.Before4Month - (response.data.Successbefore4Month + response.data.Failedbefore4Month);
                    var lastCandia = lastCandi;
                    lastCandi += response.dataAll.Before3Month - (response.data.Successbefore3Month + response.data.Failedbefore3Month);
                    var lastCandib = lastCandi;
                    lastCandi += response.dataAll.Before2Month - (response.data.Successbefore2Month + response.data.Failedbefore2Month);
                    var lastCandic = lastCandi;
                    lastCandi += response.dataAll.Before1Month - (response.data.Successbefore1Month + response.data.Failedbefore1Month);
                    var lastCandid = lastCandi;
                    lastCandi += response.dataAll.ThisMouth - (response.data.SuccessThisMouth + response.data.FailedThisMouth);
                    var lastCandie = lastCandi;


                    new Chart(document.getElementById("morris-area-chartCandiJoin"), {
                        type: 'line',
                        data: {
                            labels: [getPreviousMount(4), getPreviousMount(3), getPreviousMount(2), getPreviousMount(1), getPreviousMount(0)],
                            datasets: [
                                {
                                    label: "Participate " + response.dataAll.Count,
                                    fill: true,
                                    backgroundColor: "rgba(54, 162, 235, 0.2)",
                                    borderColor: "rgb(54, 162, 235)",
                                    pointBorderColor: "#fff",
                                    pointBackgroundColor: "rgb(54, 162, 235)",
                                    pointBorderColor: "#fff",
                                    data: [response.dataAll.Before4Month,
                                    response.dataAll.Before3Month,
                                    response.dataAll.Before2Month,
                                    response.dataAll.Before1Month,
                                    response.dataAll.ThisMouth]
                                }
                            ]
                        },
                        options: {
                            title: {
                                display: true,
                                text: 'List of candidates participating in the last 5 months'
                            }
                        }
                    });
                    new Chart(document.getElementById("morris-area-chartCandi"), {
                        type: 'line',
                        data: {
                            labels: [getPreviousMount(4), getPreviousMount(3), getPreviousMount(2), getPreviousMount(1), getPreviousMount(0)],
                            datasets: [
                                {
                                    label: "Pass: " + response.data.CountSuccess,
                                    fill: true,
                                    backgroundColor: "rgba(116, 96, 238,0.2)",
                                    borderColor: "rgba(116, 96, 238,1)",
                                    pointBorderColor: "#fff",
                                    pointBackgroundColor: "rgba(116, 96, 238,1)",
                                    data: [parseFloat(response.data.Successbefore4Month),
                                    parseFloat(response.data.Successbefore3Month),
                                    parseFloat(response.data.Successbefore2Month),
                                    parseFloat(response.data.Successbefore1Month),
                                    parseFloat(response.data.SuccessThisMouth)
                                    ]
                                }, {
                                    label: "Not Pass: " + response.data.CountFailed,
                                    fill: true,
                                    backgroundColor: "rgba(255, 60, 166, 0.2)",
                                    borderColor: "rgba(255, 60, 166,1)",
                                    pointBorderColor: "#fff",
                                    pointBackgroundColor: "rgba(255, 60, 166,1)",
                                    pointBorderColor: "#fff",
                                    data: [response.data.Failedbefore4Month,
                                    response.data.Failedbefore3Month,
                                    response.data.Failedbefore2Month,
                                    response.data.Failedbefore1Month,
                                    response.data.FailedThisMouth]
                                }, {
                                    label: "Haven't taken the exam yet: " + (response.dataAll.Count - (response.data.CountFailed + response.data.CountSuccess)),
                                    fill: true,
                                    backgroundColor: "rgba(34, 202, 128, 0.2)",
                                    borderColor: "rgba(34, 202, 128, 1)",
                                    pointBorderColor: "#fff",
                                    pointBackgroundColor: "rgba(34, 202, 128, 1)",
                                    pointBorderColor: "#fff",
                                    data: [
                                        lastCandia, lastCandib, lastCandic, lastCandid, lastCandie
                                    ]
                                }
                            ]
                        },
                        options: {
                            title: {
                                display: true,
                                text: 'Candinade results for the last 5 months'
                            }
                        }
                    });
                }


            });

            function getPreviousMount(last) {
                var thisMouth = new Date();
                var monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];
                var monthNumber = thisMouth.getMonth() - last;
                monthNumber = monthNumber < 0 ? 12 + (monthNumber) : monthNumber;
                return monthNames[monthNumber];
            }
        });
    </script>
}